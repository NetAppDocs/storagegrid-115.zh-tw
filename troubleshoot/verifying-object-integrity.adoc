---
permalink: troubleshoot/verifying-object-integrity.html 
sidebar: sidebar 
keywords:  
summary: 此系統可驗證儲存節點上物件資料的完整性、同時檢查毀損和遺失的物件。StorageGRID 
---
= 正在驗證物件完整性
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
此系統可驗證儲存節點上物件資料的完整性、同時檢查毀損和遺失的物件。StorageGRID

驗證程序有兩種：背景驗證和前景驗證。他們共同合作、確保資料完整性。背景驗證會自動執行、並持續檢查物件資料的正確性。使用者可觸發前景驗證、以更快驗證物件是否存在（雖然不正確）。



== 背景驗證是什麼

背景驗證程序會自動持續檢查儲存節點是否有物件資料毀損的複本、並自動嘗試修復找到的任何問題。

背景驗證會檢查複寫物件和銷毀編碼物件的完整性、如下所示：

* *複寫物件*：如果背景驗證程序找到毀損的複寫物件、則毀損的複本會從其位置移除、並隔離儲存節點上的其他位置。然後、系統會產生並放置新的未毀損複本、以滿足使用中的ILM原則。新複本可能不會放在原始複本所使用的儲存節點上。



NOTE: 毀損的物件資料會被隔離、而非從系統中刪除、以便仍可存取。如需存取隔離物件資料的詳細資訊、請聯絡技術支援部門。

* *刪除編碼物件*：如果背景驗證程序偵測到刪除編碼物件的片段毀損、StorageGRID 則會使用剩餘的資料和同位元檢查片段、自動嘗試在同一個儲存節點上重新建置遺失的片段。如果無法重建毀損的片段、則偵測到毀損的複本（ECOR）屬性會增加一個、並嘗試擷取物件的另一個複本。如果擷取成功、則會執行ILM評估、以建立銷毀編碼物件的替換複本。
+
背景驗證程序僅會檢查儲存節點上的物件。它不會檢查歸檔節點或雲端儲存資源池中的物件。物件必須超過四天才能符合背景驗證資格。



背景驗證會以不干擾一般系統活動的持續速度執行。背景驗證無法停止。不過、您可以提高背景驗證率、以便在懷疑有問題時更快驗證儲存節點的內容。



=== 與背景驗證相關的警示與警示（舊版）

如果系統偵測到無法自動修正的毀損物件（因為毀損可防止識別物件）、則會觸發*未識別的毀損物件偵測*警示。

如果背景驗證無法取代毀損的物件、因為它找不到其他複本、則會觸發*物件遺失*警示和遺失（遺失物件）舊版警示。



== 變更背景驗證率

如果您擔心資料完整性、可以變更背景驗證檢查儲存節點上複寫物件資料的速度。

.您需要的產品
* 您必須使用支援的瀏覽器登入Grid Manager。
* 您必須擁有特定的存取權限。


.關於這項工作
您可以變更儲存節點上背景驗證的驗證率：

* Adaptive：預設設定。此工作的設計可驗證最多4 MB/s或10個物件（以先超過者為準）。
* 高：儲存驗證會快速進行、速度可能會減慢一般系統活動的速度。


僅當您懷疑硬體或軟體故障可能有毀損的物件資料時、才可使用「高驗證率」。高優先順序背景驗證完成後、驗證率會自動重設為調適性。

.步驟
. 選取*支援*>*工具*>*網格拓撲*。
. 選取「*儲存節點_> LDR >驗證*」。
. 選擇*組態*>*主要*。
. 轉至* LdR*>* Verification*>* Configuration *>* Main*。
. 在背景驗證下、選取*驗證率*>*高*或*驗證率*>*調適性*。
+
image::../media/background_verification_rate.png[設定驗證率]




NOTE: 將「驗證率」設為「高」、會觸發通知層級的VPRI（驗證率）舊式警報。

. 按一下*套用變更*。
. 監控複寫物件的背景驗證結果。
+
.. 轉至*節點*>*儲存節點*>*物件*。
.. 在「驗證」區段中、監控*毀損物件*和*毀損物件未識別*的值。
+
如果背景驗證發現毀損的複寫物件資料、*毀損的Objects*度量會遞增、StorageGRID 而Sing會嘗試從資料中擷取物件識別碼、如下所示：

+
*** 如果可以擷取物件識別碼、StorageGRID 則會自動建立物件資料的新複本。新的複本可在StorageGRID 符合使用中ILM原則的任何地方進行。
*** 如果無法擷取物件識別碼（因為它已毀損）、則會遞增*毀損的物件Unidentified *度量、並觸發*未識別毀損的物件Detected*警示。


.. 如果發現毀損的複寫物件資料、請聯絡技術支援部門、以判斷毀損的根本原因。


. 監控銷毀編碼物件的背景驗證結果。
+
如果背景驗證發現銷毀編碼物件資料的毀損片段、則偵測到毀損的片段屬性會遞增。在同一個儲存節點上重新建置毀損的片段以恢復。StorageGRID

+
.. 選取*支援*>*工具*>*網格拓撲*。
.. 選取「*儲存節點_> LDR >刪除編碼*」。
.. 在「驗證結果」表中、監控「偵測到毀損的片段（ECCD）」屬性。


. 當作業系統自動還原毀損的物件StorageGRID 之後、請重設毀損的物件數。
+
.. 選取*支援*>*工具*>*網格拓撲*。
.. 選取「*儲存節點_> LDR >驗證>組態*」。
.. 選取*重設毀損的物件計數*。
.. 按一下*套用變更*。


. 如果您確信不需要隔離的物件、可以將其刪除。



NOTE: 如果觸發*物件遺失*警示或遺失（遺失物件）舊版警示、技術支援人員可能會想要存取隔離的物件、以協助偵錯基礎問題或嘗試資料恢復。

. 選取*支援*>*工具*>*網格拓撲*。
. 選擇「*儲存節點_*」>「* LdR *」>「*驗證*」>「*組態*」。
. 選取*刪除隔離的物件*。
. 按一下*套用變更*。




== 什麼是前景驗證

前景驗證是使用者啟動的程序、可檢查儲存節點上是否存在所有預期的物件資料。前景驗證用於驗證儲存設備的完整性。

前景驗證是一種較快的替代方法、可用來檢查儲存節點上物件資料的存在與否、但不能檢查其完整性。如果前景驗證發現有許多項目遺失、則可能是儲存節點相關的全部或部分儲存設備發生問題。

前景驗證會檢查複寫的物件資料和銷毀編碼的物件資料、如下所示：

* *複寫物件*：如果發現複寫物件資料的複本遺失、StorageGRID 則由系統其他地方儲存的複本自動取代複本。儲存節點會透過ILM評估執行現有複本、以判斷此物件不再符合目前的ILM原則、因為遺失的複本不再存在於預期位置。系統會產生並放置新的複本、以滿足系統的作用中ILM原則。此新複本可能不會放在儲存遺失複本的相同位置。
* *銷毀編碼物件*：如果發現銷毀編碼物件的片段遺失、StorageGRID 則無法使用其餘的片段、在同一個儲存節點上自動嘗試重建遺失的片段。如果無法重建遺失的片段（因為遺失了太多片段）、則偵測到毀損的複本（ECOR）屬性會遞增1。ILM接著會嘗試尋找另一個物件複本、以便用來產生新的銷毀編碼複本。
+
如果前景驗證發現儲存磁碟區上的銷毀編碼有問題、則前景驗證工作會暫停、並顯示錯誤訊息以識別受影響的磁碟區。您必須針對任何受影響的儲存磁碟區執行還原程序。



如果在網格中找不到遺失的複寫物件或毀損的銷毀編碼物件的其他複本、則會觸發*物件遺失*警示和遺失（遺失物件）舊版警示。



== 執行前景驗證

前景驗證可讓您驗證儲存節點上是否存在資料。遺失物件資料可能表示基礎儲存設備存在問題。

.您需要的產品
* 您已確保下列網格工作未執行：
+
** 網格擴充：新增儲存節點時、請新增伺服器（GEXP）
** 在同一個儲存節點上的儲存節點解除限制（LDCM）如果這些網格工作正在執行、請等待它們完成或解除鎖定。


* 您已確保儲存設備處於線上狀態。（選擇* Support *>* Tools *>* Grid topology *。然後選擇「*儲存節點_*」>「*儲存設備*」>「*總覽*」>「*主要*」。確保*儲存狀態-目前*為線上狀態。）
* 您已確定下列還原程序未在相同的儲存節點上執行：
+
** 恢復故障的儲存磁碟區
** 在恢復程序進行期間、以故障系統磁碟機進行前景驗證的方式還原儲存節點並不會提供實用資訊。




.關於這項工作
前景驗證會檢查遺失的複寫物件資料和遺失的銷毀編碼物件資料：

* 如果前景驗證發現大量遺失的物件資料、則儲存節點的儲存設備可能會發生問題、需要調查及解決。
* 如果前景驗證發現與銷毀編碼資料相關的嚴重儲存錯誤、將會通知您。您必須執行儲存磁碟區還原才能修復錯誤。


您可以設定前景驗證、以檢查儲存節點的所有物件存放區或僅檢查特定物件存放區。

如果前景驗證發現遺失的物件資料、StorageGRID 那麼The現象系統就會嘗試加以取代。如果無法進行替換複本、可能會觸發遺失（遺失物件）警示。

前景驗證會產生一個LDR前景驗證網格工作、視儲存節點上儲存的物件數目而定、可能需要數天或數週才能完成。您可以同時選取多個儲存節點、但這些網格工作不會同時執行。而是逐一排入佇列並執行、直到完成為止。在儲存節點上進行前景驗證時、您無法在同一個儲存節點上啟動另一個前景驗證工作、即使驗證其他磁碟區的選項似乎可供儲存節點使用。

如果執行前景驗證的儲存節點以外的儲存節點離線、則網格工作會繼續執行、直到*%完整*屬性達到99.99%為止。然後、*完成*屬性會回復到50%、並等待儲存節點返回線上狀態。當儲存節點的狀態恢復為線上時、LDR Foreg接地 驗證網格工作會持續到完成為止。

.步驟
. 選擇「*儲存節點_*」>「* LdR*」>「*驗證*」。
. 選擇*組態*>*主要*。
. 在「*前景驗證*」下、選取您要驗證的每個儲存Volume ID核取方塊。
+
image::../media/foreground_verification_volume_id_selection.gif[前景驗證組態頁面]

. 按一下*套用變更*。
+
請等到頁面自動重新整理並重新載入後再離開頁面。重新整理之後、物件存放區便無法在該儲存節點上進行選取。

+
系統會產生並執行一項LDR前景驗證網格工作、直到完成、暫停或中止為止。

. 監控遺失的物件或遺失的片段：
+
.. 選擇「*儲存節點_*」>「* LdR*」>「*驗證*」。
.. 在「總覽」索引標籤的「*驗證結果*」下、記下*偵測到的遺失物件*的值。
+
*注意*：節點頁面上的值報告為*遺失物件*。移至*節點*>*儲存節點*、然後選取*物件*索引標籤。

+
如果*偵測到的遺失物件數目*很大（如果有數百個遺失物件）、則儲存節點的儲存設備可能會發生問題。聯絡技術支援。

.. 選擇「*儲存節點_*>* LdR*>*刪除編碼*」。
.. 在「總覽」索引標籤的「*驗證結果*」下、記下*偵測到的遺失片段*的值。
+
如果*偵測到的遺失片段數目*很大（如果有數百個遺失的片段）、則儲存節點的儲存設備可能會發生問題。聯絡技術支援。



+
如果前景驗證未偵測到大量遺失的複寫物件複本或大量遺失的片段、則表示儲存設備運作正常。

. 監控前景驗證網格工作的完成：
+
.. 選取*支援*>*工具*>*網格拓撲*。然後選擇*站台*>*管理節點_*>* CMN*>*網格工作*>*總覽*>*主要*。
.. 驗證前景驗證網格工作是否順利進行、沒有錯誤。
+
*附註*：如果前景驗證網格工作暫停、則會在網格工作狀態（DBA）上觸發通知層級警示。

.. 如果網格工作暫停為 `critical storage error`，恢復受影響的磁碟區，然後在其餘磁碟區上執行前景驗證，以檢查是否有其他錯誤。
+
*注意*：如果前景驗證網格工作暫停並顯示訊息 `Encountered a critical storage error in volume _volID_`、您必須執行恢復故障儲存磁碟區的程序。請參閱恢復與維護指示。





.完成後
如果您仍對資料完整性有任何疑慮、請前往* LdR*>* Verification*>* Configuration *>* Main*、然後提高背景驗證率。背景驗證會檢查所有儲存的物件資料是否正確、並修復發現的任何問題。盡快找出並修復潛在問題、可降低資料遺失的風險。

.相關資訊
link:../maintain/index.html["維護"]
